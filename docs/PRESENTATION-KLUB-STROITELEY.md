# Презентация GigaBot — Клуб строителей

**Аудитория:** строители коттеджей (Россия).  
**Длительность:** 15–20 минут.  
**Формат:** история в одном Telegram-чате с логическими переходами; при необходимости — перезапуск контекста через `/new` между блоками.

---

## Идея истории

Один рабочий день прораба/руководителя строительства: от утра (новый объект, документы) до вечера (напоминания, поиск по базам, задачи). GigaBot — помощник в Telegram: проекты, файлы, база знаний, задачи, напоминания, поиск в интернете.

---

## Блок 1. Новый объект и загрузка документации  
**~3–4 мин**  
**Цель:** показать создание проекта и перенос документов в структуру папок.

### Сценарий 1.1 — Создание проекта и загрузка документации

- **Действие:** «Создай проект „Коттедж на Горной“».
- **Ожидание:** Папка проекта с подпапками: Договоры, Документация, Сметы, Фото, Переписка.
- **Показать в терминале** структуру созданной папки:
  - **Linux/macOS:**  
    `ls -la ~/.gigabot/workspace/projects/Коттедж\ на\ Горной`  
    или дерево: `tree ~/.gigabot/workspace/projects/Коттедж\ на\ Горной`
  - **Windows (PowerShell):**  
    `Get-ChildItem "$env:USERPROFILE\.gigabot\workspace\projects\Коттедж на Горной" -Recurse`
- **Действие:** Пользователь отправляет 1–2 файла (PDF смета, DOCX договор) и просит: «Положи эти файлы в проект „Коттедж на Горной“ — смету в Сметы, договор в Договоры».
- **Ожидание:** Файлы перемещены в нужные папки (через `project(move_file, ...)`).

**Точка для теста:** создание проекта + перемещение файлов по папкам.

---

### Переход (опционально `/new`)

После блока 1 можно сказать: «Отлично, документация по новому объекту на месте. Переходим к тому, как с ней потом работать — через базу знаний.»  
Если контекст перегружен — здесь логично отправить `/new` и начать блок 2 в «свежем» разговоре.

---

## Блок 2. База знаний по проекту  
**~3–4 мин**  
**Цель:** создание базы знаний и поиск по документам (RAG).

### Сценарий 2.1 — Создание базы знаний по проекту

- **Действие:** «Создай базу знаний для проекта „Коттедж на Горной“ и добавь в неё всё из папки Документация этого проекта.»
- **Ожидание:**  
  - В RAG создан проект с тем же именем (или явно связанный);  
  - Файлы из папки Документация прочитаны (PDF/DOCX), разбиты на чанки, проиндексированы в ChromaDB.
- **Важно:** путь к папке строится автоматически: `knowledge(index_folder, project="Коттедж на Горной", folder_name="Документация")`. Пользователь не должен указывать полный путь или выполнять команды в терминале.

### Сценарий 2.2 — Поиск по базе (RAG)

- **Действие:** «В каком проекте у меня были трубы 200 мм? Найди по базам знаний.»
- **Ожидание:** Вызов `knowledge(search, project=..., query="трубы 200 мм")` по нужному проекту (или по нескольким), ответ с релевантными фрагментами и указанием проекта/документа.

**Точка для теста:** создание проекта в RAG, индексация папки, семантический поиск по запросу.

---

### Переход (опционально `/new`)

«База знаний работает — по ней можно искать по всем объектам. Теперь покажу, как я фиксирую фото с объекта и текст с них.»  
При желании — `/new` перед блоком 3.

---

## Блок 3. Фото с объекта: OCR и раскладка по папкам  
**~2–3 мин**  
**Цель:** OCR с фото и перенос в папку проекта.

### Сценарий 3.1 — OCR и перенос фото в папку

- **Действие:** Пользователь отправляет фото (например, накладная или чертёж с текстом) и пишет: «Распознай текст с фото и положи это фото в проект „Коттедж на Горной“, в папку Фото.»
- **Ожидание:**  
  - Вызов OCR (Tesseract), текст распознан и озвучен в ответе или приложен;  
  - Файл сохранён в `projects/Коттедж на Горной/Фото/`.

**Точка для теста:** OCR + `project(move_file, ...)` для изображения.

---

### Переход (опционально `/new`)

«Фото с объекта теперь и распознаны, и лежат в проекте. Дальше — задачи и напоминания.»

---

## Блок 4. Задачи и напоминания  
**~3–4 мин**  
**Цель:** создание/закрытие задач и разовое напоминание.

### Сценарий 4.1 — Формирование и закрытие задач

- **Действие:** «Создай задачу: согласовать поставку арматуры по проекту „Коттедж на Горной“, дедлайн завтра 18:00.»
- **Ожидание:** Задача создана (`tasks(add, ...)`), видна в списке, привязана к проекту и с дедлайном.
- **Действие:** «Покажи мои задачи по „Коттедж на Горной“.» → «Задачу [та-то] отметь выполненной.»
- **Ожидание:** Статус задачи обновлён на «выполнена» (`tasks(complete, ...)`).

### Сценарий 4.2 — Напоминание

- **Действие:** «Через 3 часа напомни: позвонить прорабу по коттеджу на Горной.»
- **Ожидание:** Создано разовое напоминание (`cron(add, message="...", at=ISO datetime через 3 часа)`), через 3 часа бот присылает это сообщение в тот же чат.

**Точка для теста:** задачи (add, list, complete) + разовое напоминание (cron at).

---

### Переход (опционально `/new`)

«Задачи и напоминания настроены. Осталось быстро узнать цены по рынку — без выхода из чата.»

---

## Блок 5. Поиск в интернете  
**~2 мин**  
**Цель:** поиск актуальной информации (цены, поставщики).

### Сценарий 5.1 — Узнать стоимость арматуры в Екатеринбурге

- **Действие:** «Узнай в интернете, какая сейчас цена на арматуру А500С 12 мм в Екатеринбурге.»
- **Ожидание:** Вызов `web` (Brave Search), краткий ответ с ориентиром по цене/поставщикам и при необходимости ссылками.

**Точка для теста:** поиск в интернете по конкретному запросу про стройматериалы.

---

## Блок 6. Дополнительные сценарии (по времени и запросу зала)  
**~2–3 мин**

### Вариант А — Голосовой ввод

- Отправить голосовое: «Добавь задачу: заказать бетон на пятницу».
- Ожидание: SaluteSpeech STT → текст → создание задачи.

### Вариант Б — Поиск по нескольким проектам

- «Найди во всех моих проектах, где упоминается фундамент УШП».
- Ожидание: поиск по базам знаний по всем проектам (или по выбранным) и сводка.

### Вариант В — Документ по шаблону

- «Сформируй акт приёмки работ по объекту „Коттедж на Горной“ в формате DOCX.»
- Ожидание: создание DOCX через инструмент создания документов и сохранение в проект.

### Вариант Г — Напоминание по расписанию

- «Каждый понедельник в 9:00 напоминай: отчёт по объектам за неделю.»
- Ожидание: `cron(add, cron_expr="0 9 * * 1", message="...", tz="Europe/Moscow")`.

---

## Где использовать `/new`

| После блока | Причина |
|-------------|--------|
| 1 | Завершили «настройку объекта» — следующий блок про базу знаний. |
| 2 | Завершили работу с документами и RAG — переходим к фото. |
| 3 | Завершили медиа/OCR — переходим к задачам и напоминаниям. |
| 4 | Завершили организационные сценарии — переходим к поиску в интернете. |

Не обязательно делать `/new` после каждого блока: только когда хочется «сбросить» контекст перед новой темой или если ответы стали тяжёлыми. В презентации можно один раз показать: «Когда разговор становится длинным, можно начать новый через команду /new — память сохранится, а контекст чата обновится.»

---

## Чек-лист для тестов и доведения продукта

Перед конференцией стоит прогнать сценарии и зафиксировать результат.  
Базовый путь: `~/.gigabot` (на сервере).

---

### 1.1 — Создание проекта

- [ ] В Telegram: «Создай проект „Коттедж на Горной"»
- [ ] Проверка в терминале:

```bash
# Папка проекта существует и содержит 5 подпапок
ls ~/.gigabot/workspace/projects/Коттедж\ на\ Горной/

# Ожидаемый вывод:
# Договоры  Документация  Переписка  Сметы  Фото

# Дерево (если стоит tree)
tree ~/.gigabot/workspace/projects/Коттедж\ на\ Горной/
```

---

### 1.2 — Перенос файлов в папки проекта

- [ ] В Telegram: отправить PDF-смету и DOCX-договор, написать «Положи смету в Сметы, договор в Договоры проекта „Коттедж на Горной"»
- [ ] Проверка в терминале:

```bash
# Файлы в папке Сметы
ls -la ~/.gigabot/workspace/projects/Коттедж\ на\ Горной/Сметы/
# Ожидаемый вывод: файл PDF-сметы

# Файлы в папке Договоры
ls -la ~/.gigabot/workspace/projects/Коттедж\ на\ Горной/Договоры/
# Ожидаемый вывод: файл DOCX-договора

# Все файлы проекта разом
find ~/.gigabot/workspace/projects/Коттедж\ на\ Горной/ -type f
```

---

### 2.1 — Создание базы знаний + индексация

- [ ] В Telegram: «Создай базу знаний „Коттедж на Горной" и добавь в неё всё из папки Документация этого проекта»
- [ ] Проверка в терминале:

```bash
# Коллекция появилась в ChromaDB (SQLite внутри)
ls -la ~/.gigabot/rag_db/
# Должна быть непустая директория / файлы ChromaDB

# Проверить наличие коллекции программно
python3 -c "
import chromadb
client = chromadb.PersistentClient(path='$HOME/.gigabot/rag_db')
collections = client.list_collections()
for c in collections:
    print(f'{c.name}: {c.count()} chunks')
"
# Ожидаемый вывод: Коттедж на Горной: N chunks (N > 0)
```

---

### 2.2 — Поиск по базе знаний (RAG)

- [ ] В Telegram: «В каком проекте у меня были трубы 200 мм?»
- [ ] Проверка: ответ бота содержит релевантные фрагменты из документации с указанием проекта/файла.
- [ ] Дополнительная проверка в терминале (ручной поиск):

```bash
# Прямой поиск по ChromaDB
python3 -c "
import chromadb
client = chromadb.PersistentClient(path='$HOME/.gigabot/rag_db')
for col in client.list_collections():
    results = col.query(query_texts=['трубы 200 мм'], n_results=3)
    if results['documents'][0]:
        print(f'=== {col.name} ===')
        for doc in results['documents'][0]:
            print(doc[:200])
            print('---')
"
```

---

### 3.1 — OCR + сохранение фото в папку проекта

- [ ] В Telegram: отправить фото (накладная/чертёж с текстом), написать «Распознай текст и положи фото в проект „Коттедж на Горной", папку Фото»
- [ ] Проверка: бот вернул распознанный текст в сообщении.
- [ ] Проверка в терминале:

```bash
# Фото появилось в папке Фото проекта
ls -la ~/.gigabot/workspace/projects/Коттедж\ на\ Горной/Фото/
# Ожидаемый вывод: файл изображения (*.jpg / *.png)

# Оригинал в media (откуда перемещён)
ls -la ~/.gigabot/media/
```

---

### 4.1 — Создание, просмотр и закрытие задач

- [ ] В Telegram: «Создай задачу: согласовать поставку арматуры, проект „Коттедж на Горной", дедлайн завтра 18:00»
- [ ] Затем: «Покажи задачи» → «Отметь эту задачу выполненной»
- [ ] Проверка в терминале:

```bash
# Файл задач (JSON)
cat ~/.gigabot/tasks/tasks.json | python3 -m json.tool

# Ожидаемый вывод: массив с задачей, поля:
#   "title": "согласовать поставку арматуры"
#   "project": "Коттедж на Горной"
#   "status": "done"    (после закрытия)
#   "deadline": "..."    (ISO datetime)

# Быстрый фильтр по проекту
python3 -c "
import json
tasks = json.load(open('$HOME/.gigabot/tasks/tasks.json'))
for t in tasks:
    if 'Горной' in t.get('project',''):
        print(f\"[{t['status']}] {t['title']} — дедлайн: {t.get('deadline','нет')}\")
"
```

---

### 4.2 — Напоминание «через N часов»

- [ ] В Telegram: «Через 3 часа напомни: позвонить прорабу по коттеджу на Горной»
- [ ] Проверка в терминале:

```bash
# Файл расписания (cron jobs)
cat ~/.gigabot/cron/jobs.json | python3 -m json.tool

# Ожидаемый вывод: задание с полями:
#   "name": "позвонить прорабу..."
#   "schedule": { "kind": "at", "at_ms": ... }
#   "message": "позвонить прорабу по коттеджу на Горной"
#   "delete_after_run": true

# Проверить время срабатывания
python3 -c "
import json, datetime
jobs = json.load(open('$HOME/.gigabot/cron/jobs.json'))
for j in jobs:
    if 'at_ms' in j.get('schedule', {}):
        dt = datetime.datetime.fromtimestamp(j['schedule']['at_ms'] / 1000)
        print(f\"{j['name']} → сработает в {dt.strftime('%Y-%m-%d %H:%M:%S')}\")
"
```

---

### 5.1 — Поиск в интернете

- [ ] В Telegram: «Узнай в интернете цену на арматуру А500С 12 мм в Екатеринбурге»
- [ ] Проверка: бот вернул ответ с ценой/поставщиками и ссылками.
- [ ] Терминальная проверка (необязательно, но можно убедиться что web tool вызван):

```bash
# В логах сервиса должен быть вызов web tool
sudo journalctl -u gigabot --since "5 min ago" --no-pager | grep -i "web\|brave\|search"
```

---

### Опциональные сценарии

**Голосовой ввод:**
- [ ] Отправить голосовое, проверить распознанный текст в логах:

```bash
sudo journalctl -u gigabot --since "2 min ago" --no-pager | grep -i "salute\|stt\|voice"
```

**Генерация DOCX:**
- [ ] «Сформируй акт приёмки работ в DOCX», проверить файл:

```bash
find ~/.gigabot/workspace/projects/Коттедж\ на\ Горной/ -name "*.docx" -newer /tmp/test_marker
```

**Еженедельное напоминание:**
- [ ] «Каждый понедельник в 9:00 напоминай: отчёт за неделю», проверить:

```bash
cat ~/.gigabot/cron/jobs.json | python3 -m json.tool
# Ожидаемый вывод: задание с "kind": "cron", "expr": "0 9 * * 1"
```

---

## Краткий тайминг (суммарно 15–20 мин)

| Блок | Содержание | Время |
|------|------------|-------|
| Вступление | Кто такой GigaBot, зачем строителю (один чат: документы, база знаний, задачи, напоминания, поиск) | 1–2 мин |
| 1 | Новый проект + загрузка документации | 3–4 мин |
| 2 | База знаний: создание + поиск (например, трубы 200 мм) | 3–4 мин |
| 3 | OCR + фото в папку проекта | 2–3 мин |
| 4 | Задачи + напоминание «через 3 часа» | 3–4 мин |
| 5 | Поиск в интернете (арматура, Екатеринбург) | 2 мин |
| 6 | 1–2 доп. сценария по желанию | 2–3 мин |
| Заключение | Резюме, контакты, вопросы | 1–2 мин |

---

*Документ можно использовать и как сценарий презентации, и как план тестирования перед выступлением.*
